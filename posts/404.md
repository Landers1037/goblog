pythonå¤šçº¿ç¨‹ä¸è¿›ç¨‹

<!--more-->

å®ç°çš„ä¸‰ç§æ¨¡å¼ï¼š

å¤šè¿›ç¨‹ï¼Œå¼€å¯å¤šä¸ªè¿›ç¨‹ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡

å¤šçº¿ç¨‹ï¼Œå¼€å¯ä¸€ä¸ªè¿›ç¨‹é‡Œé¢å¤šä¸ªçº¿ç¨‹

å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼Œå¼€å¯å¤šä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹é‡Œå…è®¸å¤šä¸ªçº¿ç¨‹

### å¤šçº¿ç¨‹

```python
from threading import Thread,local,Lock
import threading

def run(name):
    print("now run %s",threading.currentThread(),name)
    
print('thread %s is running...' % threading.current_thread().name)    
t1 = Thread(target=run,args=("1",))
t2 = Thread(target=run,args=("2",))

t1.start()
t1.join()
t2.start()
t2.join()
```

ä½¿ç”¨Pythonçš„threadingæ¨¡å—åˆ›å»ºæ–°çš„çº¿ç¨‹å®ä¾‹

ä½¿ç”¨`threading.current_thread()`å¯ä»¥å¾—åˆ°å½“å‰æ‰§è¡Œçš„çº¿ç¨‹çš„åç§°

pythonè¿è¡Œç¨‹åºæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹é‡Œforkå‡ºå­çº¿ç¨‹

```python
thread MainThread is running...
now run %s <Thread(Thread-1, started 3100)> 1
now run %s <Thread(Thread-2, started 11508)> 2
```

### é”ğŸ”’

é»˜è®¤çš„åœ¨æ¯ä¸ªå­çº¿ç¨‹é‡Œå®šä¹‰çš„å±€éƒ¨å˜é‡åªæœ‰å¯¹åº”çš„å­çº¿ç¨‹å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å½“æœ‰ä¸€ä¸ªå…¨å±€å˜é‡éœ€è¦å¤šä¸ªçº¿ç¨‹ä¸€åŒè®¿é—®ä¿®æ”¹æ—¶å°±ä¼šå‡ºç°é—®é¢˜

æ¯”å¦‚

```python
g = 10
def run(num):
    # print("now run %s",threading.currentThread(),num)
    global g
    g +=num
    g -=num

def runlong(num):
    for i in range(1000000):
        run(num)

t1 = Thread(target=runlong,args=(14,))
t2 = Thread(target=runlong,args=(4,))

print('thread %s is running...' % threading.current_thread().name)
t1.start()
t2.start()
t1.join()
t2.join()

print(g)
```

å› ä¸ºçº¿ç¨‹çš„è¿ç®—æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœå¯èƒ½ä¸æ˜¯æœŸæœ›çš„ç»“æœ

å¼•å…¥threadingçš„LockğŸ”’å¯ä»¥ä¿è¯çº¿ç¨‹è®¿é—®çš„æ—¶å€™ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å¹²æ‰°

```python
g = 10
lock = Lock()
def run(num):
    global g
    g +=num
    g -=num

def runlong(num):
    for i in range(1000000):
        try:
            lock.acquire()
            run(num)
        finally:
            lock.release()
            

t1 = Thread(target=runlong,args=(14,))
t2 = Thread(target=runlong,args=(4,))

print('thread %s is running...' % threading.current_thread().name)
t1.start()
t2.start()
t1.join()
t2.join()
```

åœ¨æ¯æ¬¡è®¿é—®ä¿®æ”¹å‰éƒ½ç»™çº¿ç¨‹åŠ ä¸Šé”ï¼Œä¸ºäº†ä¿è¯